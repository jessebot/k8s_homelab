[Zitadel](https://zitadel.com/) is an Identity Management solution that includes acting as an OIDC provider.

Zitadel is one of the more complex apps that `smol-k8s-lab` supports out of the box. For initialization, you need to pass in the following info:

- `username` - name of the first admin user to create
- `email` - email of the first admin user
- `first name` - first name of the first admin user
- `last name` - last name of the first admin user
- `gender` - optional - the gender of the first admin user

The above values are used to create an initial user. We also create Argo CD admin and users groups to be used with an Argo CD OIDC app that we prepare. If Vouch is enabled, we also create an OIDC app for that as well as a user group. You initial user is automatically added to all the groups we create.

Finally, we create a groupsClaim so that all queries for auth also process the user's groups.

In addition to those one time init values, we also require a hostname to use for the Zitadel API and web frontend.

## Example config

```yaml
apps:
  zitadel:
    enabled: false
    description: |
      ZITADEL is an open source self hosted IAM platform for the cloud era

      Learn more: [link=https://zitadel.com/opensource]https://zitadel.com/opensource[/link]
      smol-k8s-lab supports initialization of:
      - an admin service account
      - a human admin user (including an autogenerated password)
      - 2 OIDC applications for Argo CD and Vouch
      - 2 Argo CD groups (admins and users), 1 vouch groups
      - groupsClaim action to enforce group roles on authentication
      - updates your appset_secret_plugin secret and refreshes the pod
    init:
      # Switch to false if you don't want to create initial secrets or use the
      # API via a service account to create the above described resources
      enabled: true
      values:
        username: 'certainlynotadog'
        email: 'notadog@humans.com'
        first_name: 'Dogsy'
        last_name: 'Dogerton'
        # options: GENDER_UNSPECIFIED, GENDER_MALE, GENDER_FEMALE, GENDER_DIVERSE
        # more coming soon, see: https://github.com/zitadel/zitadel/issues/6355
        gender: GENDER_UNSPECIFIED
    argo:
      # secrets keys to make available to ArgoCD ApplicationSets
      secret_keys:
        # FQDN to use for zitadel
        hostname: 'zitadel.gooddogs.com'
        # type of database to use: postgresql or cockroachdb
        database_type: postgresql
      # repo to install the Argo CD app from
      # git repo to install the Argo CD app from
      repo: https://github.com/small-hack/argocd-apps
      # path in the argo repo to point to. Trailing slash very important!
      # if you want to use cockroachdb, change to zitadel/zitadel_and_cockroachdb
      path: zitadel/zitadel_and_postgresql
      # either the branch or tag to point at in the argo repo above
      ref: main
      # namespace to install the k8s app in
      namespace: zitadel
      # source repos for Argo CD App Project (in addition to argo.repo)
      project:
        source_repos:
        - https://charts.zitadel.com
        - https://zitadel.github.io/zitadel-charts
        - https://charts.cockroachdb.com/
        - registry-1.docker.io
        destination:
          namespaces:
          - argocd
          - zitadel
```

You can learn more about our Zitadel Argo CD Application at [small-hack/argocd-apps/zitadel](https://github.com/small-hack/argocd-apps/tree/main/zitadel).
